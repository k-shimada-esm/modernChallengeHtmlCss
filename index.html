<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <?!= HtmlService.createHtmlOutputFromFile('style').getContent(); ?>
    <title>bookApp</title>
</head>
<body>
  <header>
    <h1>
        書籍管理
    </h1>
  </header>
  <div>
    <input class='registration-button' type='button' value='新規登録'>
  </div>
  <table>
    <thead>
      <th>書籍番号</th>
      <th>タイトル</th>
      <th>ジャンル</th>
      <th>購入日</th>
      <th>購入者</th>
    </thead>
    <tbody id='bookDataList'></tbody>
  </table>

  <script type='text/javascript'>
    const books = []; // 一覧データ

    try {
      // 一覧データの設定
      // await this.loadData();
      const bookData = await new Promise((resolve, reject) => {
        window.google.script.run
          .withSuccessHandler(pData => resolve(pData))
          .withFailureHandler(Error => reject(Error))
          .readFromBookTableByFilter('', '')
      });
      console.log(bookData);
      books = bookData.books;
    } catch (error) {
      alert(`情報を取得できませんでした。[${error}]`)
    }

    const bookListElement = document.getElementById('bookDataList');
    books.forEach(bookInfo => {
      const tr = document.createElement('tr');
      this.generateTd(tr, bookInfo.bookNo);
      this.generateTd(tr, bookInfo.title);
      this.generateTd(tr, bookInfo.genre);
      this.generateTd(tr, bookInfo.purchaseDate);
      this.generateTd(tr, bookInfo.purchasePerson);
      bookListElement.appendChild(tr);
    })
    function generateTd(tr, bookValue) {
      const td = document.createElement('td');
      td.textContent = bookValue;
      tr.appendChild(td);
    };
    /**
     * 親画面から受け取った検索フィルタデータの条件にヒットした書籍データを取得する
     *   ※検索フィルタデータが初期値の場合は全件検索される
     * @return {配列} 書籍データ
     */
    // async function loadData () {
    //   // 書籍テーブルから書籍データを取得する
    //   const bookData = await new Promise((resolve, reject) => {
    //     window.google.script.run
    //       .withSuccessHandler(pData => resolve(pData))
    //       .withFailureHandler(Error => reject(Error))
    //       .readFromBookTableByFilter('', '')
    //   });
    //   console.log(bookData);
    //   this.books = bookData.books;
    // }
  </script>
</body>
</html>
